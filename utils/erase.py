import os
from typing import Optional
from dotenv import load_dotenv
from pymongo import MongoClient

# db에 필요한 항목만 남기기

load_dotenv()  # .env 파일 로드

remains = ["경기-수원-2025-00480", "전북-정읍-2025-00481", "울산-남구-2025-00385", "광주-광산-2025-00490",
            "서울-강북-2025-00129", "인천-계양-2025-00372", "부산-북구-2025-00301","전북-전주-2025-00927",
            "경남-함안-2025-00266", "경기-용인-2025-00440", "대구-서구-2025-00478", "경기-고양-2025-00628",
            "경기-구리-2025-00119", "대구-중구-2025-00251", "경기-군포-2025-00173", "울산-북구-2025-00257",
            "부산-서구-2025-00257", "대구-달서-2025-00255",
            "서울-강동-2025-00118", "경기-여주-2025-00413", "경기-부천-2025-00508", "경기-평택-2025-01407",
            "경기-부천-2025-00502", "경기-수원-2025-00452", "대구-수성-2025-00518", "서울-강동-2025-00114",
            "경기-시흥-2025-00406", "대구-수성-2025-00515",
            "전남-나주-2025-01145", "대전-동구-2025-00210", "경기-용인-2025-00404", "전남-목포-2025-00424",
            "부산-서구-2025-00236", "경기-이천-2025-00498", "대구-군위-2025-00188", "충북-영동-2025-00195",
            "서울-동대문-2025-00243", "대구-서구-2025-00419",
            "대구-중구-2025-00234", "경기-광주-2025-00460", "전북-전주-2025-00774", "강원-원주-2025-00384",
            "경기-용인-2025-00356", "충남-보령-2025-00301", "충남-보령-2025-00300", "전북-전주-2025-00720",
            "서울-동대문-2025-00217", "울산-울주-2025-00500", "충남-아산-2025-00407", "경기-안산-2025-00523",
            "서울-용산-2025-00111", "전남-영광-2025-00149", "서울-동대문-2025-00195",
            "제주-제주-2025-01671", "서울-동대문-2025-00189", "경북-성주-2025-00203", "인천-중구-2025-00274",
            "충남-예산-2025-00190",
            "경북-구미-2025-00457",
            "경북-구미-2025-00438",
            "강원-고성-2025-00123",
            "경북-경산-2025-00510",
            "경북-경산-2025-00517",
            "경기-양평-2025-00379",
            "강원-정선-2025-00240",
            "충남-청양-2025-00091",
            "경기-화성-2025-01285",
            "경기-화성-2025-01293",
            "경북-울진-2025-00245",
            "경북-상주-2025-00204",
            "전남-고흥-2025-00259",
            "전북-정읍-2025-00493",
            "충북-음성-2025-00736",
            "강원-강릉-2025-00300",
            "경북-경산-2025-00509",
            "경북-포항-2025-00792",
            "경남-김해-2025-00740",
            "경북-울진-2025-00244",
            "전북-익산-2025-01336",
            "경남-창원1-2025-00678",
            "충남-태안-2025-00468",
            "경기-안성-2025-00571",
            "울산-울주-2025-00685",
            "울산-울주-2025-00681",
            "경기-파주-2025-00798",
            "경북-성주-2025-00277",
            "경북-성주-2025-00271",
            "경북-성주-2025-00284",
            "경북-청도-2025-00278",
            "전남-신안-2025-00174",
            "전남-여수-2025-00379",
            "전북-정읍-2025-00490",
            "충남-태안-2025-00467",
            "충남-아산-2025-00539",
            "충북-단양-2025-00025",
            "강원-화천-2025-00041",
            "경기-안산-2025-00727",
            "광주-광산-2025-00503",
            "충남-부여-2025-00331",
            "충남-부여-2025-00327",
            "충남-부여-2025-00318",
            "제주-제주-2025-02347",
            "전남-나주-2025-01333",
            "울산-울주-2025-00678",
            "경북-영덕-2025-00218",
            "경북-경산-2025-00504",
            "경북-김천-2025-00328",
            "경남-하동-2025-00165",
            "충남-부여-2025-00317",
            "강원-영월-2025-00053",
            "경기-안산-2025-00721",
            "대전-동구-2025-00226",
            "인천-미추홀-2025-00239",
            "경남-창원1-2025-00667",
            "전북-부안-2025-00668",
            "충북-음성-2025-00730",
            "강원-홍천-2025-00123",
            "경북-김천-2025-00323",
            "전북-익산-2025-01322",
            "전북-익산-2025-01320",
            "제주-제주-2025-02310",
            "경남-함안-2025-00268",
            "경북-경산-2025-00499",
            "경북-상주-2025-00192",
            "전남-신안-2025-00173",
            "충북-음성-2025-00720",
            "경기-광주-2025-00571",
            "경기-용인-2025-00460",
            "대구-군위-2025-00227",
            "대구-군위-2025-00225",
            "충북-음성-2025-00717",
            "강원-고성-2025-00120",
            "울산-동구-2025-00171",
            "울산-울주-2025-00663",
            "경남-남해-2025-00130",
            "경북-상주-2025-00188",
            "전남-순천-2025-00443",
            "강원-강릉-2025-00287",
            "전남-순천-2025-00443",
            "강원-강릉-2025-00287",
            "경기-광주-2025-00593",
            "경기-시흥-2025-00451",
            "경기-용인-2025-00408",
            "서울-동작-2025-00158",
            "경기-안산-2025-00571",
            "충북-청주-2025-00554",
            "경기-평택-2025-01241",
            "경기-성남-2025-00387",
            "충북-영동-2025-00216",
            "경기-부천-2025-00501",
            "전북-익산-2025-01285",
            "서울-영등포-2025-00068",
            "경남-김해-2025-00700",
            "전북-정읍-2025-00329",
            "경기-평택-2025-01083",
            "대전-대덕-2025-00105",
            "경북-청송-2025-00107",
            "전북-부안-2025-00486",
            "경남-함안-2025-00165",
            "경남-함안-2025-00182",
            "경남-함안-2025-00179",
            "경남-함안-2025-00174",
            "인천-강화-2025-00449",
            "경기-평택-2025-01104",
            "전남-완도-2025-00155",
            "경남-창원1-2025-00459",
            "충남-공주-2025-00191",
            "강원-평창-2025-00042",
            "전북-부안-2025-00503",
            "전북-김제-2025-00232",
            "충남-천안-2025-00378",
            "전북-부안-2025-00504",
            "경기-평택-2025-01122",
            "전남-완도-2025-00160",
            "울산-남구-2025-00271",
            "전남-여수-2025-00262",
            "경기-화성-2025-00927",
            "강원-횡성-2025-00110",
            "경기-양평-2025-00276",
            "경북-경산-2025-00367",
            "경북-의성-2025-00137",
            "경기-평택-2025-01139",
            "전북-익산-2025-00962",
            "경북-울진-2025-00184",
            "전남-구례-2025-00067",
            "경남-창녕-2025-00321",
            "경기-안산-2025-00522",
            "경기-안산-2025-00526",
            "경남-밀양-2025-00537",
            "경남-합천-2025-00255",
            "경남-진주-2025-00233",
            "전남-보성-2025-00062",
            "경남-합천-2025-00243",
            "강원-고성-2025-00066",
            "경기-양평-2025-00280",
            "경기-시흥-2025-00308",
            "경기-평택-2025-01147"
           ]

improve = ["0","0","0",
"0",
"1",
"0",
"1",
"0",
"1",
"1",
"0",
"1",
"0",
"2",
"1",
"2",
"1",
"0",
"1",
"0",
"0",
"0",
"0",
"1",
"2",
"1",
"0",
"0",
"1",
"2",
"0",
"0",
"0",
"1",
"0",
"1",
"0",
"0",
"0",
"0",
"1",
"1",
"0",
"1",
"1",
"0",
"0",
"0",
"1",
"0",
"1",
"1",
"0",
"1",
"0",
"0",
"1",
"0",
"0",
"1",
"1",
"2",
"2",
"0",
"0",
"1",
"0",
"1",
"1",
"0",
"1",
"0",
"2",
"0",
"2",
"2",
"1",
"1",
"0",
"0",
"1",
"1",
"0",
"2",
"2",
"0",
"0",
"2",
"0",
"1",
"1",
"0",
"1",
"0",
"0",
"1",
"2",
"0",
"1",
"1",
"2",
"0",
"2",
"0",
"0",
"2",
"0",
"1",
"1",
"0",
"1",
"1",
"0",
"0",
"2",
"1",
"1",
"0",
"0",
"0",
"0",
"0",
"2",
"0",
"0",
"0",
"1",
"0",
"1",
"1",
"1",
"1",
"0",
"0",
"0",
"1",
"0",
"1",
"0",
"1",
"1",
"0",
"0",
"1",
"1",
"2",
"2",
"1",
"2",
"0",
"1",
"0",
"0",
"1",
"1",
"2",
"0",
"1",
"1",
"0",
"0",
"2",
"0",
"0",
"1",
"0",
"1",
"2",
"2",
"1",
"0",
"1",
"1",
"2",
"1",
"1",
"0",
"1",
"0",
"1",
"2",
"1",
"1",
"1",
"2",
"1",
"1",
"1",
"2",
"2",
"1",
"1",
"1",
"1",
"0",
"1"
]

try:
    uri = os.getenv("MONGODB_URI")
    client = MongoClient(uri)
    db = client["testdb"]
    collection = db["abandoned_animals"]
    collection.create_index("desertionNo", unique=True)
    print ("db connected")
except Exception as e:
    print("db connection error:", e)

# try:
#     uri = os.getenv("MONGODB_URI")
#     client = MongoClient(uri)
#     db = client["testdb"]
#     collection = db["new_collection"]
#     collection.create_index("desertionNo", unique=True)
#     print ("db connected")
# except Exception as e:
#     print("db connection error:", e)

index = 0
remap = dict(zip(remains, improve))
for doc in collection.find():
    notice_no = doc.get("noticeNo")
    if notice_no in remap:
        collection.update_one(
            {"noticeNo": notice_no},
            {"$set": {"improve": remap[notice_no], "extractedFeature": None}}
        )

collection.delete_many({ "noticeNo": { "$nin": remains }}) 


